# 改善履歴

## 2026-01-03: downloader.py yt-dlp JS チャレンジ解決の修正
**問題**: プレイリストの最初の動画だけが .m4a (音声のみ) になり、2番目以降は .mp4 になる
**原因**: yt-dlp の JavaScript チャレンジ解決器が初回リクエスト時に失敗し、video format が取得できない
**解決策**:
- `remote_components: {"ejs:github"}` オプションを追加し、チャレンジ解決スクリプトを事前ダウンロード
- `progress_hooks` を `postprocessor_hooks` に変更し、マージ後の最終ファイル名を正確にキャプチャ
**変更ファイル**: `downloader.py`
**教訓**: yt-dlp のログ警告を注意深く確認することで根本原因を特定できる

## 2025-12-26: main.py バッチ処理機能追加
**問題**: 複数のオーディオファイルを処理する際、1つずつ手動で実行する必要があった
**解決策**: main.py にディレクトリ一括処理機能を追加
**変更内容**:
- `transcribe_file()` 関数を分離してコードをリファクタリング
- ディレクトリパスを指定すると、含まれる全音声/動画ファイルを自動処理
- `-o` オプションをオプショナル化（入力ファイル名から自動生成）
- 対応フォーマット: wav, mp3, m4a, flac, ogg, aac, wma, mp4, webm, mkv, avi, mov
- 進捗バーにファイル名を表示
**教訓**: 関数分離により機能拡張が容易になる

## 2025-12-26: mlx-whisper への移行
**問題**: faster-whisper (CTranslate2) は CPU のみ使用で、Apple Silicon M3 の性能を活かせない
**解決策**: mlx-whisper を導入。MLX フレームワークにより Apple Silicon の GPU/Neural Engine を活用
**成果**:
- M3 チップに最適化された高速推論
- 複数出力フォーマット対応 (txt, json, srt, vtt, tsv)
- 単語レベルタイムスタンプ機能
**教訓**: ハードウェアに最適化されたライブラリ選択が重要

## 2025-06-17: 進捗バーの導入
**問題**: 長時間処理時の進捗が分かりづらい
**試行錯誤**: tqdm 導入で解決
**教訓**: ユーザー体験向上には進捗可視化が有効
